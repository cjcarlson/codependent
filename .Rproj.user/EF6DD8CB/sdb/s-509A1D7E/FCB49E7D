{
    "collab_server" : "",
    "contents" : " \nload('C:/Users/cjcar/Documents/Github/helminthLDR/analysis/figshare/ldr.Rdata')\n\n\nsub.acan <- data.frame(group='',Host='',Parasite='',ParasiteFull='',locality='')\nsub.acan <- sub.acan[-1,]\nfor (i in 1:length(acans)) {\n  if(!is.null(acans[[i]])) {\n  sub.sub.acan <- acans[[i]]\n  sub.sub.acan$group='Acanthocephala'\n  sub.sub.acan$locality=names(acans)[[i]]\n  sub.acan <- rbind(sub.acan,sub.sub.acan)\n  }\n}\n\n\nsub.cest <- data.frame(group='',Host='',Parasite='',ParasiteFull='',locality='')\nsub.cest <- sub.cest[-1,]\nfor (i in 1:length(cests)) {\n  if(!is.null(cests[[i]])) {\n    sub.sub.cest <- cests[[i]]\n    sub.sub.cest$group='Cestoda'\n    sub.sub.cest$locality=names(cests)[[i]]\n    sub.cest <- rbind(sub.cest,sub.sub.cest)\n  }\n}\n\n\nsub.nema <- data.frame(group='',Host='',Parasite='',ParasiteFull='',locality='')\nsub.nema <- sub.nema[-1,]\nfor (i in 1:length(nemas)) {\n  if(!is.null(nemas[[i]])) {\n    sub.sub.nema <- nemas[[i]]\n    sub.sub.nema$group='Nematoda'\n    sub.sub.nema$locality=names(nemas)[[i]]\n    sub.nema <- rbind(sub.nema,sub.sub.nema)\n  }\n}\n\n\nsub.trem <- data.frame(group='',Host='',Parasite='',ParasiteFull='',locality='')\nsub.trem <- sub.trem[-1,]\nfor (i in 1:length(trems)) {\n  if(!is.null(trems[[i]])) {\n    sub.sub.trem <- trems[[i]]\n    sub.sub.trem$group='Trematoda'\n    sub.sub.trem$locality=names(trems)[[i]]\n    sub.trem <- rbind(sub.trem,sub.sub.trem)\n  }\n}\n\nassociations <- rbind(sub.acan,sub.cest,sub.nema,sub.trem)\n\n## CLEANING TIME ##\n\nassociations <- associations[!is.na(associations$Host),]\nassociations <- associations[!is.na(associations$Parasite),]\n\nassociations <- associations[!associations$Host=='',]\nassociations <- associations[!associations$Parasite=='',]\n\nspex <- function(x) {return(!(length(grep(\"sp.\",x))==1))}\n\nsps <- apply(associations,c(1,2),spex)\nassociations <- associations[sps[,1]==TRUE,]\nsps <- apply(associations,c(1,2),spex)\nassociations <- associations[sps[,2]==TRUE,]\n\nassociations <- associations[!(substr(associations$ParasiteFull,1,1)==\"(\"),]\nassociations <- associations[!(substr(associations$Host,1,1)==\"(\"),]\n\ntwoname <- function(x) {\n  y <- strsplit(x,\" \")\n  return(length(y[[1]][!y[[1]]==''])>1)\n}\n\nsps <- apply(associations,c(1,2),twoname)\nassociations <- associations[sps[,1]==TRUE,]\nsps <- apply(associations,c(1,2),twoname)\nassociations <- associations[sps[,2]==TRUE,]\n\nrevis <- function(name) {\n  \n  list <- strsplit(name,' ')[[1]]\n  \n  if(substr(list[2],1,1)=='(') {\n    return(paste(list[1],list[3]))\n  } else {\n    if(substr(list[2],1,1)=='['){\n      return(paste(list[1],list[3]))\n    } else {\n      return(paste(list[1],list[2]))\n    }\n  }\n}\n\nfor (i in 1:nrow(associations)) {\n  associations$Parasite[i] <- revis(associations$ParasiteFull[i])\n}\n\nfor (i in 1:nrow(associations)) {\n  associations$Host[i] <- revis(associations$Host[i])\n}\n\n\n\n\n\n\nclassifier <- function(name) { \n  name2 <- tryCatch(gnr_resolve(name, best_match_only = TRUE)$matched_name,error=function(e) {NULL})\n  if(is.null(name2)) {\n    return(c(name,NA))\n  } else {\n  ids <- tryCatch(suppressMessages(get_tsn_(name2,accepted=FALSE)[[1]]$tsn),error=function(e) {NA})\n  if (length(ids)==0) { return (c(name,NA)) } else {\n  ids <- ids[[1]]\n  ids <- as.numeric(as.character(ids))\n  x <- classification(ids, db = 'itis')[[1]]\n  if(nrow(x)==1) {\n    ids <- tryCatch(synonyms(ids,db='itis')[[1]]$acc_tsn[1], error=function(e) {NA})\n    if(is.na(ids)) {\n      return(c(name2,NA))\n    } else {\n    x <- classification(ids, db = 'itis')[[1]]\n    }\n  }\n  if(nrow(x[x$rank=='class',])>0) {\n  species <- x[x$rank=='species',]$name\n  class <- x[x$rank=='class',]$name\n  return(c(species,class))\n  } else {\n    return(c(name2,NA))\n  }\n  }\n  }\n}\n\ndictionary <- data.frame(hosts = unique(associations$Host), hostclean='', group='')\ndictionary$hosts <- as.character(dictionary$hosts)\ndictionary$hostclean <- as.character(dictionary$hostclean)\ndictionary$group <- as.character(dictionary$group)\n\n\n\nfor(i in 1:nrow(dictionary)){\n  pb <- txtProgressBar(min = 0, max = nrow(dictionary), style = 3)\n  dictionary[i,2:3] <- classifier(dictionary$hosts[i])\n  setTxtProgressBar(pb, i)\n}\n\nwrite.csv(dictionary,'dictionary.csv')\nwrite.csv(associations,'associations uncleaned.csv')\n\n## associations <- read.csv('associations uncleaned.csv')\n\nassociations$hostgroup <- NA\n\nfor (i in 1:nrow(associations)){\n  associations$Host[i] <- dictionary[dictionary$hosts==associations$Host[i],]$hostclean\n  \n  if(!length(dictionary$group[dictionary$hosts==associations$Host[i]])==0) {\n    \n  associations$hostgroup[i] <- as.character(dictionary[dictionary$hosts==associations$Host[i],]$group)\n                                            \n  }\n}\nwrite.csv(associations,'associations cleaned.csv')\n\nwrite.csv(associations,'C:/Users/cjcar/Documents/Github/humanhelminths/associations cleaned.csv')\n\n\n\nhuman <- associations[associations$Host=='Homo sapiens',]\nwrite.csv(human,'C:/Users/cjcar/Documents/Github/humanhelminths/human helminth associations.csv')\n\n\n######################################################################################\n\n\n# Curvemaking functions\n# Takes a clean list of host parasite associations and rarefies parasite diversity on hosts\n\ncurve.df <- function(assoc.df, iter){\n  \n  u.hosts <- unique(assoc.df$Host)\n  n.hosts <- length(u.hosts)\n  \n  results.df <- data.frame(n.host=0,n.par=0)\n  results.df <- results.df[-1,]\n  \n  for (i in 1:n.hosts) {\n    #for (i in 1:5) {\n    for (j in 1:iter) {\n      \n      sub.hosts <- sample(u.hosts,i)\n      sub.df <- assoc.df[assoc.df$Host %in% sub.hosts,]\n      u.par <- unique(sub.df$Parasite)\n      n.par <- length(u.par)\n      \n      results.df[nrow(results.df)+1,] <- c(i, n.par)\n    }\n    print(i)\n  }\n  return(results.df)\n}\n\nsub.acan <- associations[associations$group=='Acanthocephala',]\nsub.cest <- associations[associations$group=='Cestoda',]\nsub.nema <- associations[associations$group=='Nematoda',]\nsub.trem <- associations[associations$group=='Trematoda',]\n\n\n\n\nacan.curve <- curve.df(sub.acan,5)\ncest.curve <- curve.df(sub.cest,5)\nnema.curve <- curve.df(sub.nema,5)\ntrem.curve <- curve.df(sub.trem,5)\n\n\nplot(trem.curve, col='green')\npoints(nema.curve, col='blue')\npoints(acan.curve, col='red')\npoints(cest.curve, col='orange')\n\n\npar(mfrow=c(2,2), mar=c(5,5,0.5,0.5))\n\nac.m1 <- lm(n.par ~ n.host, data=acan.curve)\nac.m2 <- lm(n.par ~ log(n.host), data=acan.curve)\nac.m3 <- lm(n.par ~ sqrt(n.host), data=acan.curve)\nplot(acan.curve, col='grey', xlab='Host species', ylab='Acanthocephalan species')\nlines(acan.curve$n.host, predict(ac.m1), col = \"green\", lwd=2)\nlines(acan.curve$n.host, predict(ac.m2), col = \"blue\", lwd=2)\nlines(acan.curve$n.host, predict(ac.m3), col = \"red\", lwd=2)\n\nce.m1 <- lm(n.par ~ n.host, data=cest.curve)\nce.m2 <- lm(n.par ~ log(n.host), data=cest.curve)\nce.m3 <- lm(n.par ~ sqrt(n.host), data=cest.curve)\nplot(cest.curve, col='grey', xlab='Host species', ylab='Cestode species')\nlines(cest.curve$n.host, predict(ce.m1), col = \"green\", lwd=2)\nlines(cest.curve$n.host, predict(ce.m2), col = \"blue\", lwd=2)\nlines(cest.curve$n.host, predict(ce.m3), col = \"red\", lwd=2)\n\nne.m1 <- lm(n.par ~ n.host, data=nema.curve)\nne.m2 <- lm(n.par ~ log(n.host), data=nema.curve)\nne.m3 <- lm(n.par ~ sqrt(n.host), data=nema.curve)\nplot(nema.curve, col='grey', xlab='Host species', ylab='Nematode species')\nlines(nema.curve$n.host, predict(ne.m1), col = \"green\", lwd=2)\nlines(nema.curve$n.host, predict(ne.m2), col = \"blue\", lwd=2)\nlines(nema.curve$n.host, predict(ne.m3), col = \"red\", lwd=2)\n\ntr.m1 <- lm(n.par ~ n.host, data=trem.curve)\ntr.m2 <- lm(n.par ~ log(n.host), data=trem.curve)\ntr.m3 <- lm(n.par ~ sqrt(n.host), data=trem.curve)\nplot(trem.curve, col='grey', xlab='Host species', ylab='Trematode species')\nlines(trem.curve$n.host, predict(tr.m1), col = \"green\", lwd=2)\nlines(trem.curve$n.host, predict(tr.m2), col = \"blue\", lwd=2)\nlines(trem.curve$n.host, predict(tr.m3), col = \"red\", lwd=2)\n\n\n\n###########################  HOW MANY SPECIES TOTAL   ################################\n\nsub.ma.ac <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ac <- sub.ma.ac[sub.ma.ac$group %in% c('Acanthocephala'),]\nsub.ma.ac <- sub.ma.ac[,c(1:2)]\nsub.ma.ac <- unique(sub.ma.ac)\ncurve.ma.ac <- curve.df(sub.ma.ac,100)\nma.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.ma.ac)\n\nsub.ma.ce <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ce <- sub.ma.ce[sub.ma.ce$group %in% c('Cestoda'),]\nsub.ma.ce <- sub.ma.ce[,c(1:2)]\nsub.ma.ce <- unique(sub.ma.ce)\ncurve.ma.ce <- curve.df(sub.ma.ce,100)\nma.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.ma.ce)\n\nsub.ma.ne <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ne <- sub.ma.ne[sub.ma.ne$group %in% c('Nematoda'),]\nsub.ma.ne <- sub.ma.ne[,c(1:2)]\nsub.ma.ne <- unique(sub.ma.ne)\ncurve.ma.ne <- curve.df(sub.ma.ne,100)\nma.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.ma.ne)\n\nsub.ma.tr <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.tr <- sub.ma.tr[sub.ma.tr$group %in% c('Trematoda'),]\nsub.ma.tr <- sub.ma.tr[,c(1:2)]\nsub.ma.tr <- unique(sub.ma.tr)\ncurve.ma.tr <- curve.df(sub.ma.tr,100)\nma.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.ma.tr)\n\nround(ma.ac.m$coefficients[[1]] + ma.ac.m$coefficients[[2]]*sqrt(4637))\nround(ma.ce.m$coefficients[[1]] + ma.ce.m$coefficients[[2]]*sqrt(4637))\nround(ma.ne.m$coefficients[[1]] + ma.ne.m$coefficients[[2]]*sqrt(4637))\nround(ma.tr.m$coefficients[[1]] + ma.tr.m$coefficients[[2]]*sqrt(4637))\n\n\n\n\nsub.re.ac <- associations[associations$hostgroup %in% c('Reptilia'),]\nsub.re.ac <- sub.re.ac[sub.re.ac$group %in% c('Acanthocephala'),]\nsub.re.ac <- sub.re.ac[,c(1:2)]\nsub.re.ac <- unique(sub.re.ac)\ncurve.re.ac <- curve.df(sub.re.ac,100)\nre.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.re.ac)\n\nsub.re.ce <- associations[associations$hostgroup %in% c('Reptilia'),]\nsub.re.ce <- sub.re.ce[sub.re.ce$group %in% c('Cestoda'),]\nsub.re.ce <- sub.re.ce[,c(1:2)]\nsub.re.ce <- unique(sub.re.ce)\ncurve.re.ce <- curve.df(sub.re.ce,100)\nre.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.re.ce)\n\nsub.re.ne <- associations[associations$hostgroup %in% c('Reptilia'),]\nsub.re.ne <- sub.re.ne[sub.re.ne$group %in% c('Nematoda'),]\nsub.re.ne <- sub.re.ne[,c(1:2)]\nsub.re.ne <- unique(sub.re.ne)\ncurve.re.ne <- curve.df(sub.re.ne,100)\nre.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.re.ne)\n\nsub.re.tr <- associations[associations$hostgroup %in% c('Reptilia'),]\nsub.re.tr <- sub.re.tr[sub.re.tr$group %in% c('Trematoda'),]\nsub.re.tr <- sub.re.tr[,c(1:2)]\nsub.re.tr <- unique(sub.re.tr)\ncurve.re.tr <- curve.df(sub.re.tr,100)\nre.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.re.tr)\n\nround(re.ac.m$coefficients[[1]] + re.ac.m$coefficients[[2]]*sqrt(6300))\nround(re.ce.m$coefficients[[1]] + re.ce.m$coefficients[[2]]*sqrt(6300))\nround(re.ne.m$coefficients[[1]] + re.ne.m$coefficients[[2]]*sqrt(6300))\nround(re.tr.m$coefficients[[1]] + re.tr.m$coefficients[[2]]*sqrt(6300))\n\n\n\nsub.av.ac <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ac <- sub.av.ac[sub.av.ac$group %in% c('Acanthocephala'),]\nsub.av.ac <- sub.av.ac[,c(1:2)]\nsub.av.ac <- unique(sub.av.ac)\ncurve.av.ac <- curve.df(sub.av.ac,100)\nav.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.av.ac)\n\nsub.av.ce <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ce <- sub.av.ce[sub.av.ce$group %in% c('Cestoda'),]\nsub.av.ce <- sub.av.ce[,c(1:2)]\nsub.av.ce <- unique(sub.av.ce)\ncurve.av.ce <- curve.df(sub.av.ce,100)\nav.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.av.ce)\n\nsub.av.ne <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ne <- sub.av.ne[sub.av.ne$group %in% c('Nematoda'),]\nsub.av.ne <- sub.av.ne[,c(1:2)]\nsub.av.ne <- unique(sub.av.ne)\ncurve.av.ne <- curve.df(sub.av.ne,100)\nav.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.av.ne)\n\nsub.av.tr <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.tr <- sub.av.tr[sub.av.tr$group %in% c('Trematoda'),]\nsub.av.tr <- sub.av.tr[,c(1:2)]\nsub.av.tr <- unique(sub.av.tr)\ncurve.av.tr <- curve.df(sub.av.tr,100)\nav.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.av.tr)\n\nround(av.ac.m$coefficients[[1]] + av.ac.m$coefficients[[2]]*sqrt(9040))\nround(av.ce.m$coefficients[[1]] + av.ce.m$coefficients[[2]]*sqrt(9040))\nround(av.ne.m$coefficients[[1]] + av.ne.m$coefficients[[2]]*sqrt(9040))\nround(av.tr.m$coefficients[[1]] + av.tr.m$coefficients[[2]]*sqrt(9040))\n\n\n\n\n\n\nsub.am.ac <- associations[associations$hostgroup %in% c('Amphibia'),]\nsub.am.ac <- sub.am.ac[sub.am.ac$group %in% c('Acanthocephala'),]\nsub.am.ac <- sub.am.ac[,c(1:2)]\nsub.am.ac <- unique(sub.am.ac)\ncurve.am.ac <- curve.df(sub.am.ac,100)\nam.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.am.ac)\n\nsub.am.ce <- associations[associations$hostgroup %in% c('Amphibia'),]\nsub.am.ce <- sub.am.ce[sub.am.ce$group %in% c('Cestoda'),]\nsub.am.ce <- sub.am.ce[,c(1:2)]\nsub.am.ce <- unique(sub.am.ce)\ncurve.am.ce <- curve.df(sub.am.ce,100)\nam.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.am.ce)\n\nsub.am.ne <- associations[associations$hostgroup %in% c('Amphibia'),]\nsub.am.ne <- sub.am.ne[sub.am.ne$group %in% c('Nematoda'),]\nsub.am.ne <- sub.am.ne[,c(1:2)]\nsub.am.ne <- unique(sub.am.ne)\ncurve.am.ne <- curve.df(sub.am.ne,100)\nam.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.am.ne)\n\nsub.am.tr <- associations[associations$hostgroup %in% c('Amphibia'),]\nsub.am.tr <- sub.am.tr[sub.am.tr$group %in% c('Trematoda'),]\nsub.am.tr <- sub.am.tr[,c(1:2)]\nsub.am.tr <- unique(sub.am.tr)\ncurve.am.tr <- curve.df(sub.am.tr,100)\nam.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.am.tr)\n\nround(am.ac.m$coefficients[[1]] + am.ac.m$coefficients[[2]]*sqrt(4975))\nround(am.ce.m$coefficients[[1]] + am.ce.m$coefficients[[2]]*sqrt(4975))\nround(am.ne.m$coefficients[[1]] + am.ne.m$coefficients[[2]]*sqrt(4975))\nround(am.tr.m$coefficients[[1]] + am.tr.m$coefficients[[2]]*sqrt(4975))\n\n\n\n\n\n\nsub.os.ac <- associations[associations$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]\nsub.os.ac <- sub.os.ac[sub.os.ac$group %in% c('Acanthocephala'),]\nsub.os.ac <- sub.os.ac[,c(1:2)]\nsub.os.ac <- unique(sub.os.ac)\ncurve.os.ac <- curve.df(sub.os.ac,100)\nos.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.os.ac)\n\nsub.os.ce <- associations[associations$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]\nsub.os.ce <- sub.os.ce[sub.os.ce$group %in% c('Cestoda'),]\nsub.os.ce <- sub.os.ce[,c(1:2)]\nsub.os.ce <- unique(sub.os.ce)\ncurve.os.ce <- curve.df(sub.os.ce,100)\nos.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.os.ce)\n\nsub.os.ne <- associations[associations$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]\nsub.os.ne <- sub.os.ne[sub.os.ne$group %in% c('Nematoda'),]\nsub.os.ne <- sub.os.ne[,c(1:2)]\nsub.os.ne <- unique(sub.os.ne)\ncurve.os.ne <- curve.df(sub.os.ne,100)\nos.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.os.ne)\n\nsub.os.tr <- associations[associations$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]\nsub.os.tr <- sub.os.tr[sub.os.tr$group %in% c('Trematoda'),]\nsub.os.tr <- sub.os.tr[,c(1:2)]\nsub.os.tr <- unique(sub.os.tr)\ncurve.os.tr <- curve.df(sub.os.tr,100)\nos.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.os.tr)\n\nround(os.ac.m$coefficients[[1]] + os.ac.m$coefficients[[2]]*sqrt(18150))\nround(os.ce.m$coefficients[[1]] + os.ce.m$coefficients[[2]]*sqrt(18150))\nround(os.ne.m$coefficients[[1]] + os.ne.m$coefficients[[2]]*sqrt(18150))\nround(os.tr.m$coefficients[[1]] + os.tr.m$coefficients[[2]]*sqrt(18150))\n\n\n\n\n\n\nsub.ch.ac <- associations[associations$hostgroup %in% c(\"Chondrichthyes\"),]\nsub.ch.ac <- sub.ch.ac[sub.ch.ac$group %in% c('Acanthocephala'),]\nsub.ch.ac <- sub.ch.ac[,c(1:2)]\nsub.ch.ac <- unique(sub.ch.ac)\ncurve.ch.ac <- curve.df(sub.ch.ac,100)\nch.ac.m <- lm(n.par ~ sqrt(n.host), data=curve.ch.ac)\n\nsub.ch.ce <- associations[associations$hostgroup %in% c(\"Chondrichthyes\"),]\nsub.ch.ce <- sub.ch.ce[sub.ch.ce$group %in% c('Cestoda'),]\nsub.ch.ce <- sub.ch.ce[,c(1:2)]\nsub.ch.ce <- unique(sub.ch.ce)\ncurve.ch.ce <- curve.df(sub.ch.ce,100)\nch.ce.m <- lm(n.par ~ sqrt(n.host), data=curve.ch.ce)\n\nsub.ch.ne <- associations[associations$hostgroup %in% c(\"Chondrichthyes\"),]\nsub.ch.ne <- sub.ch.ne[sub.ch.ne$group %in% c('Nematoda'),]\nsub.ch.ne <- sub.ch.ne[,c(1:2)]\nsub.ch.ne <- unique(sub.ch.ne)\ncurve.ch.ne <- curve.df(sub.ch.ne,100)\nch.ne.m <- lm(n.par ~ sqrt(n.host), data=curve.ch.ne)\n\nsub.ch.tr <- associations[associations$hostgroup %in% c(\"Chondrichthyes\"),]\nsub.ch.tr <- sub.ch.tr[sub.ch.tr$group %in% c('Trematoda'),]\nsub.ch.tr <- sub.ch.tr[,c(1:2)]\nsub.ch.tr <- unique(sub.ch.tr)\ncurve.ch.tr <- curve.df(sub.ch.tr,100)\nch.tr.m <- lm(n.par ~ sqrt(n.host), data=curve.ch.tr)\n\nround(ch.ac.m$coefficients[[1]] + ch.ac.m$coefficients[[2]]*sqrt(843))\nround(ch.ce.m$coefficients[[1]] + ch.ce.m$coefficients[[2]]*sqrt(843))\nround(ch.ne.m$coefficients[[1]] + ch.ne.m$coefficients[[2]]*sqrt(843))\nround(ch.tr.m$coefficients[[1]] + ch.tr.m$coefficients[[2]]*sqrt(843))\n\n\n############################ Mammals ##################################################\n\n\nsub.ma.ac <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ac <- sub.ma.ac[sub.ma.ac$group %in% c('Acanthocephala'),]\nsub.ma.ac <- sub.ma.ac[,c(1:2)]\nsub.ma.ac <- unique(sub.ma.ac)\ncurve.ma.ac <- curve.df(sub.ma.ac,100)\nma.ac.m1 <- lm(n.par ~ n.host, data=curve.ma.ac)\nma.ac.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ac)\nma.ac.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ac)\n\n\nsub.ma.ce <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ce <- sub.ma.ce[sub.ma.ce$group %in% c('Cestoda'),]\nsub.ma.ce <- sub.ma.ce[,c(1:2)]\nsub.ma.ce <- unique(sub.ma.ce)\ncurve.ma.ce <- curve.df(sub.ma.ce,100)\nma.ce.m1 <- lm(n.par ~ n.host, data=curve.ma.ce)\nma.ce.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ce)\nma.ce.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ce)\n\n\nsub.ma.ne <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.ne <- sub.ma.ne[sub.ma.ne$group %in% c('Nematoda'),]\nsub.ma.ne <- sub.ma.ne[,c(1:2)]\nsub.ma.ne <- unique(sub.ma.ne)\ncurve.ma.ne <- curve.df(sub.ma.ne,100)\nma.ne.m1 <- lm(n.par ~ n.host, data=curve.ma.ne)\nma.ne.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ne)\nma.ne.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ne)\n\n\nsub.ma.tr <- associations[associations$hostgroup %in% c('Mammalia'),]\nsub.ma.tr <- sub.ma.tr[sub.ma.tr$group %in% c('Trematoda'),]\nsub.ma.tr <- sub.ma.tr[,c(1:2)]\nsub.ma.tr <- unique(sub.ma.tr)\ncurve.ma.tr <- curve.df(sub.ma.tr,100)\nma.tr.m1 <- lm(n.par ~ n.host, data=curve.ma.tr)\nma.tr.m2 <- lm(n.par ~ log(n.host), data=curve.ma.tr)\nma.tr.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.tr)\n\n\n############################ PLOTS ####################################################\npar(mfrow=c(2,2))\npar(mar=c(4,4,1,1))\n\nplot(curve.ma.ac, col='grey', xlab='Mammal species', ylab='Acanthocephalan species',\n     xlim=c(0,5000),ylim=c(0,800))\nlines(curve.ma.ac$n.host, predict(ma.ac.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ac$n.host):4637), \n      predict.lm(ma.ac.m1,newdata=data.frame(n.host=c(max(curve.ma.ac$n.host):4637))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ac$n.host, predict(ma.ac.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ac$n.host):4637), \n      predict.lm(ma.ac.m3,newdata=data.frame(n.host=c(max(curve.ma.ac$n.host):4637))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(0.28/4.32),col='black',lty=3)\nabline(v=4637,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.ce, col='grey', xlab='Mammal species', ylab='Cestode species',\n     xlim=c(0,5000),ylim=c(0,5000))\nlines(curve.ma.ce$n.host, predict(ma.ce.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ce$n.host):4637), \n      predict.lm(ma.ce.m1,newdata=data.frame(n.host=c(max(curve.ma.ce$n.host):4637))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ce$n.host, predict(ma.ce.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ce$n.host):4637), \n      predict.lm(ma.ce.m3,newdata=data.frame(n.host=c(max(curve.ma.ce$n.host):4637))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(1.89/1.89),col='black',lty=3)\nabline(v=4637,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.ne, col='grey', xlab='Mammal species', ylab='Nematode species',\n     xlim=c(0,5000),ylim=c(0,6000))\nlines(curve.ma.ne$n.host, predict(ma.ne.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ne$n.host):4637), \n      predict.lm(ma.ne.m1,newdata=data.frame(n.host=c(max(curve.ma.ne$n.host):4637))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ne$n.host, predict(ma.ne.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ne$n.host):4637), \n      predict.lm(ma.ne.m3,newdata=data.frame(n.host=c(max(curve.ma.ne$n.host):4637))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(3.90/6.07),col='black',lty=3)\nabline(v=4637,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.tr, col='grey', xlab='Mammal species', ylab='Trematode species',\n     xlim=c(0,5000),ylim=c(0,4000))\nlines(curve.ma.tr$n.host, predict(ma.tr.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.tr$n.host):4637), \n      predict.lm(ma.tr.m1,newdata=data.frame(n.host=c(max(curve.ma.tr$n.host):4637))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.tr$n.host, predict(ma.tr.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.tr$n.host):4637), \n      predict.lm(ma.tr.m3,newdata=data.frame(n.host=c(max(curve.ma.tr$n.host):4637))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(1.61/2.01),col='black',lty=3)\nabline(v=4637,col='black',lty=1,lwd=3)\n\n\n\n\n############################ Birds ##################################################\n\n\nsub.av.ac <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ac <- sub.av.ac[sub.av.ac$group %in% c('Acanthocephala'),]\nsub.av.ac <- sub.av.ac[,c(1:2)]\nsub.av.ac <- unique(sub.av.ac)\ncurve.ma.ac <- curve.df(sub.av.ac,10)\nma.ac.m1 <- lm(n.par ~ n.host, data=curve.ma.ac)\nma.ac.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ac)\nma.ac.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ac)\n\n\nsub.av.ce <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ce <- sub.av.ce[sub.av.ce$group %in% c('Cestoda'),]\nsub.av.ce <- sub.av.ce[,c(1:2)]\nsub.av.ce <- unique(sub.av.ce)\ncurve.ma.ce <- curve.df(sub.av.ce,10)\nma.ce.m1 <- lm(n.par ~ n.host, data=curve.ma.ce)\nma.ce.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ce)\nma.ce.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ce)\n\n\nsub.av.ne <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.ne <- sub.av.ne[sub.av.ne$group %in% c('Nematoda'),]\nsub.av.ne <- sub.av.ne[,c(1:2)]\nsub.av.ne <- unique(sub.av.ne)\ncurve.ma.ne <- curve.df(sub.av.ne,10)\nma.ne.m1 <- lm(n.par ~ n.host, data=curve.ma.ne)\nma.ne.m2 <- lm(n.par ~ log(n.host), data=curve.ma.ne)\nma.ne.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.ne)\n\n\nsub.av.tr <- associations[associations$hostgroup %in% c('Aves'),]\nsub.av.tr <- sub.av.tr[sub.av.tr$group %in% c('Trematoda'),]\nsub.av.tr <- sub.av.tr[,c(1:2)]\nsub.av.tr <- unique(sub.av.tr)\ncurve.ma.tr <- curve.df(sub.av.tr,10)\nma.tr.m1 <- lm(n.par ~ n.host, data=curve.ma.tr)\nma.tr.m2 <- lm(n.par ~ log(n.host), data=curve.ma.tr)\nma.tr.m3 <- lm(n.par ~ sqrt(n.host), data=curve.ma.tr)\n\n\n############################ PLOTS ####################################################\npar(mfrow=c(2,2))\n\nplot(curve.ma.ac, col='grey', xlab='Bird species', ylab='Acanthocephalan species',\n     xlim=c(0,9500),ylim=c(0,1000))\nlines(curve.ma.ac$n.host, predict(ma.ac.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ac$n.host):9040), \n      predict.lm(ma.ac.m1,newdata=data.frame(n.host=c(max(curve.ma.ac$n.host):9040))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ac$n.host, predict(ma.ac.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ac$n.host):9040), \n      predict.lm(ma.ac.m3,newdata=data.frame(n.host=c(max(curve.ma.ac$n.host):9040))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(0.72/8.35),col='black',lty=3)\nabline(v=9040,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.ce, col='grey', xlab='Bird species', ylab='Cestode species',\n     xlim=c(0,9500),ylim=c(0,15000))\nlines(curve.ma.ce$n.host, predict(ma.ce.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ce$n.host):9040), \n      predict.lm(ma.ce.m1,newdata=data.frame(n.host=c(max(curve.ma.ce$n.host):9040))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ce$n.host, predict(ma.ce.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ce$n.host):9040), \n      predict.lm(ma.ce.m3,newdata=data.frame(n.host=c(max(curve.ma.ce$n.host):9040))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(3.67/2.36),col='black',lty=3)\nabline(v=9040,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.ne, col='grey', xlab='Bird species', ylab='Nematode species',\n     xlim=c(0,9500),ylim=c(0,9500))\nlines(curve.ma.ne$n.host, predict(ma.ne.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.ne$n.host):9040), \n      predict.lm(ma.ne.m1,newdata=data.frame(n.host=c(max(curve.ma.ne$n.host):9040))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.ne$n.host, predict(ma.ne.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.ne$n.host):9040), \n      predict.lm(ma.ne.m3,newdata=data.frame(n.host=c(max(curve.ma.ne$n.host):9040))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(3.32/3.28),col='black',lty=3)\nabline(v=9040,col='black',lty=1,lwd=3)\n\n\nplot(curve.ma.tr, col='grey', xlab='Bird species', ylab='Trematode species',\n     xlim=c(0,9500),ylim=c(0,11000))\nlines(curve.ma.tr$n.host, predict(ma.tr.m1), col = \"green\", lwd=3)\nlines(c(max(curve.ma.tr$n.host):9040), \n      predict.lm(ma.tr.m1,newdata=data.frame(n.host=c(max(curve.ma.tr$n.host):9040))),\n      col = \"green\", lwd=3,lty=3)\nlines(curve.ma.tr$n.host, predict(ma.tr.m3), col = \"red\", lwd=3)\nlines(c(max(curve.ma.tr$n.host):9040), \n      predict.lm(ma.tr.m3,newdata=data.frame(n.host=c(max(curve.ma.tr$n.host):9040))),\n      col = \"red\", lwd=3,lty=3)\n\nabline(0,(3.24/2.97),col='black',lty=3)\nabline(v=9040,col='black',lty=1,lwd=3)\n\n\n\n\n\n\n###################### UPDATING NUMBERS #############################\n\ngeneralism <- data.frame(table(unique(associations[,c(1,2,4,6)])[,c(2,3,4)]))\ngeneralism <- generalism[!generalism$Freq==0,]\ngeneralism$hostgroup <- as.character(generalism$hostgroup)\ngeneralism[generalism$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]$hostgroup <- \"Osteichthys\" \n\nhs <- ddply(generalism, c(\"group\",\"hostgroup\"), summarise,\n               hs = mean(Freq)\n)\nhs <- hs[hs$hostgroup %in% c(\"Aves\",\"Chondrichthyes\",\"Osteichthys\",\"Mammalia\",\"Amphibia\",\"Reptilia\"),]\nhs <- reshape2::acast(hs, group ~ hostgroup)\nhs <- hs[,c(3,5,1,6,2,4)]\nhs <- round(hs,2)\n\n\n\n\n########### WHAT PERCENT ARE DESCRIBED #######################\n\npaircounts <- unique(associations[,c(2,4,6)])\n\npaircounts[paircounts$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]$hostgroup <- \"Osteichthys\" \n\npaircounts <- table(paircounts$group,paircounts$hostgroup)\n \n\n\n\n############# ",
    "created" : 1537681335214.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2451255695",
    "id" : "FCB49E7D",
    "lastKnownWriteTime" : 1532229990,
    "last_content_update" : 1532229990,
    "path" : "C:/Users/cjcar/Dropbox/helminths/2018 analysis/helminthR consolidation.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}