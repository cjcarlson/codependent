{
    "collab_server" : "",
    "contents" : "library(plyr)\n\nassociations <- read.csv('C:/Users/cjcar/Dropbox/helminths/associations cleaned.csv')\nassociations <- associations[,-1]\n\nassociations$genus <- ''\nassociations$year <- ''\n\nfor(i in 1:nrow(associations)) {\n\nx <- strsplit(as.character(associations$ParasiteFull[i]),' ')[[1]]\nassociations$year[i] <- gsub(\")\",\"\",x[length(x)])\nassociations$year[i] <- gsub(\"\\\\(\",\"\",associations$year[i])\n\nx <- strsplit(as.character(associations$Parasite[i]),' ')[[1]]\nassociations$genus[i] <- gsub(\" \",\"\",x[1])\n\nprint(i)\n}\n\ngenera <- unique(associations[,c(2,7,8)])\n\n\n\ngeneralism <- data.frame(table(unique(associations[,c(1,2,4,6)])[,c(2,3,4)]))\ngeneralism <- generalism[!generalism$Freq==0,]\ngeneralism$hostgroup <- as.character(generalism$hostgroup)\ngeneralism[generalism$hostgroup %in% c(\"Chondrostei\", \"Holostei\", \"Cladistei\", \"Teleostei\"),]$hostgroup <- \"Osteichthys\" \n\n\ngenera$hs <- 0\n\nfor (i in 1:nrow(genera)) {\n  \n  genera$hs[i] <- sum(generalism[generalism$Parasite==genera$Parasite[i],]$Freq)\n  print(i)\n  \n}\n\ngenera$year <- as.numeric(genera$year)\ngenera$year[genera$year>2018] <- NA\ngenera$year[genera$year<1700] <- NA\n\n\n\ngenlist <- unique(genera$genus)\n\ngenera$first <- ''\n\nfor (i in 1:length(genlist)) {\n  working <- genera[genera$genus==genlist[i],]\n  \n  working <- na.omit(working)\n  \n  if(nrow(working)>0) {\n  \n  if(length(na.omit(working$year))>1) {\n    genera[genera$genus==genlist[i],]$first <- 'not the first'\n    genera[genera$Parasite %in% working[working$year==min(working$year),]$Parasite,]$first <- 'first'\n    \n    \n  } else {\n    genera[genera$genus==genlist[i],]$first <- 'exclude'\n    \n  }\n    \n  } else {\n    genera[genera$genus==genlist[i],]$first <- 'exclude'\n  }\n}\n\n# genera <- read.csv('helminthR taxauth.csv')\n\n\n\ngenera.sub <- genera[!genera$first=='exclude',]\nboxplot(log(hs) ~ first, data=genera.sub)\nsummary(aov(hs~as.factor(first)+Error(as.factor(genus)), data = genera.sub))\nkruskal.test(hs~as.factor(first), data = genera.sub)\n\nwilcox.test(hs~as.factor(first), data=genera.sub)\n\n\n# genera\n\ngen.omit <- na.omit(genera)\ngen.omit <- gen.omit[!(gen.omit$hs==0),]\ngen.omit$loghs <- log(gen.omit$hs)\n#plot(gen.omit$loghs ~ gen.omit$year, pch=16, xlab='year', ylab='log(host specificity)')\n#lines(smooth.spline(gen.omit$year,gen.omit$loghs, spar=0.5),type='l',col='red',lwd=2)\n\nMyGAM1 <- gam(hs ~  s(year), family=nb, data=gen.omit)\nsummary(MyGAM1)\n#plot(MyGAM1, residuals=F, se=TRUE, pch=19, cex=0.75, scheme=0, shade=F, col='red', rug=TRUE,\n#     xlab = \"year\", ylab = \"log(host specificity)\")\n\n\nyofa <- read.csv('C:/Users/cjcar/Dropbox/helminths/YOFA hosts.csv')\nMyGAM0 <- gam(hosts ~ s(yearone), family=nb, data=yofa)\n\n#lines(spec, residuals=F, se=TRUE,pch=19, cex=0.75, scheme=0, shade=F, col='blue', xlab = \"year\", ylab = \"log(host specificity)\", add=TRUE)\n     \nresponse1 <- predict(MyGAM1, type=\"response\", se.fit=T)\nresponse0 <- predict(MyGAM0, type=\"response\", se.fit=T)\n\n\nlayout(matrix(c(1,2,2,3), 1, 3, byrow = TRUE), \n       widths=c(1,1,1,1), heights=c(1,2))\n\n\npar(mar=c(5,5,2,3))\nboxplot(log(hs) ~ first, data=genera.sub, ylab='log(host specificity)', bty=\"n\", \n        col=c('#e9a3c9','#a1d76a'), cex.lab=1.4, cex.axis=1.4)\n\nplot(0, type=\"n\", bty=\"n\", main=\"\", xlab=\"Year\", ylab=\"host specificity\", lwd=3, ylim=c(0,50), xlim=c(1700,2045),\n     cex.lab=1.4, cex.axis=1.4)\nlegend(\"topright\", bty=\"n\", lwd=3, col=c(\"#998ec3\",\"#f1a340\"), legend=c(\"NHM\", \"USNPC\"),\n       cex=1.4)\n\nlines(sm.spline(MyGAM1$model$year , response1$fit) , lwd = 3 , col = \"#998ec3\")\nlines(sm.spline(MyGAM1$model$year , response1$fit+1.96*response1$se) , lty = 2 , lwd = 2 , col = \"#998ec3\")\nlines(sm.spline(MyGAM1$model$year , response1$fit-1.96*response1$se) , lty = 2 , lwd = 2 , col = \"#998ec3\")\n\nlines(sm.spline(MyGAM0$model$yearone , response0$fit) , lwd = 3 , col = \"#f1a340\")\nlines(sm.spline(MyGAM0$model$yearone , response0$fit + 1.96 * response0$se) , lty = 2 , lwd = 2, col = \"#f1a340\")\nlines(sm.spline(MyGAM0$model$yearone , response0$fit - 1.96 * response0$se) , lty = 2 , lwd = 2 , col = \"#f1a340\")\n\n\n###################\n\npar(mfrow=c(1,1))\nhead(gen.omit)\nyear.df <- data.frame(table(gen.omit$year))\nyear.df$cumsum <- cumsum(year.df$Freq)\nplot(cumsum ~ Var1, data=year.df , xlab='Year', ylab = 'Parasite species described')\n\nnhm.m1 <- lm(Cumulative ~ Years, data=century)\n\n# linear since 1945?\n\n\n",
    "created" : 1537681664039.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1713144947",
    "id" : "D4DD3636",
    "lastKnownWriteTime" : 1532814413,
    "last_content_update" : 1532814413,
    "path" : "C:/Users/cjcar/Dropbox/helminths/founder effect.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}